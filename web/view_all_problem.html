<!DOCTYPE html>
<html ng-app="myapp">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover, shrink-to-fit=no">
    <meta name="description" content="Women Legal App">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#100DD1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!-- The above tags *must* come first in the head, any other head content must come *after* these tags-->
    <!-- Title-->
    <title>Women Legal App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="css/font.css" rel="stylesheet">
    <!-- Favicon-->
    <link rel="icon" href="img/icons/icon-72x72.png">
    <!-- Apple Touch Icon-->
    <link rel="apple-touch-icon" href="img/icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="152x152" href="img/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="img/icons/icon-167x167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/icons/icon-180x180.png">
    <!-- CSS Libraries-->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/lineicons.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <!-- Stylesheet-->
    <link rel="stylesheet" href="style.css">
    <!-- Web App Manifest-->
    <link rel="manifest" href="manifest.json">
	<!-- angular js -->
	<script src="js/angular-1.3.js"></script>
	<script src="js/angular_cookies.js"></script>

  </head>
  <body ng-controller="myappCtrl">
    <!-- Preloader-->
    <div class="preloader" id="preloader">
      <div class="spinner-grow text-secondary" role="status">
        <div class="sr-only">Loading...</div>
      </div>
    </div>
    <!-- Header Area-->
          <!-- Header Area-->
    <div class="header-area" id="headerArea">
      <div class="container h-100 d-flex align-items-center justify-content-between">
        <!-- Logo Wrapper-->
        <div class="logo-wrapper"><a href="home.html"><img src="img/core-img/logo-small.png" alt="">&nbsp; &nbsp; Women Legal App</a></div>
       
        <!-- Navbar Toggler-->
        <div class="suha-navbar-toggler" data-bs-toggle="offcanvas" data-bs-target="#suhaOffcanvas" aria-controls="suhaOffcanvas"><span></span><span></span><span></span></div>
      </div>
    </div>
    <div class="offcanvas offcanvas-start suha-offcanvas-wrap" tabindex="-1" id="suhaOffcanvas" aria-labelledby="suhaOffcanvasLabel">
      <!-- Close button-->
      <button class="btn-close btn-close-white text-reset" type="button" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      <!-- Offcanvas body-->
      <div class="offcanvas-body">
        <!-- Sidenav Profile-->
        <div class="sidenav-profile">
          <div class="user-profile"><img src="img/bg-img/9.png" alt=""></div>
          <div class="user-info">
            <h6 class="user-name mb-1">Women Legal App</h6>
          
          </div>
        </div>
        <!-- Sidenav Nav-->
        <ul class="sidenav-nav ps-0">
        
            
         <li><a href="home.html"><i class="lni lni-home
"></i>Home</a></li>
          
           <li><a style="color:white;" ng-click="user_logout()"><i class="lni lni-power-switch"></i>Logout</a></li>
      </div>
    </div>
      </div>
    </div>
 
    <div class="page-content-wrapper">
      <!-- Catagory Single Image-->
     
      <!-- Product Catagories-->
      <div class="product-catagories-wrapper py-3">
        <div class="container">
     
        
      <!-- Top Products-->
      <div class="top-products-area pb-3">
	
        <div class="container">
          <div class="section-heading d-flex align-items-center justify-content-between">
            <h6>Views all the women problem
			</h6>
			
          </div>
      
		   <div class="top-search-form">
          <form>
            <input class="form-control" ng-model="search_field" type="search" placeholder="Search">
            <button type="submit"><i class="fa fa-search"></i></button>
          </form>
        </div>
        <div class="card p-2 mt-5">
          <table class="table table-bordered problems">
            <thead class="bg-primary text-light">
              <tr>
                <th scope="col">#</th>
                <th scope="col">User</th>
                <th scope="col">Case Number</th>
                <th scope="col">Case Type</th>
                <th scope="col">Address</th>
                <th scope="col">Problem Background</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
            
            </tbody>
          </table>
        </div>
        <div class="row g-3 problems" >
            <!-- Single Top Product Card -->
          
			  </div>
      
              </div>
            </div>
          </div>
        </div>
     </div>
    <!-- Internet Connection Status-->
    <div class="internet-connection-status" id="internetStatus"></div>
    <!-- Footer Nav-->
       <div class="footer-nav-area" id="footerNav">
      <div class="container h-100 px-0">
        <div class="suha-footer-nav h-100">
          <ul class="h-100 d-flex align-items-center justify-content-between ps-0">
            <li class="active"><a href="home.html"><i class="lni lni-home"></i>Home</a></li>
            
            <li><a ng-click="user_logout()"><i class="lni lni-power-switch"></i>Logout</a></li>
          </ul>
        </div>
      </div>
    </div>
    <!-- All JavaScript Files-->
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/waypoints.min.js"></script>
    <script src="js/jquery.easing.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/jquery.passwordstrength.js"></script>
    <script src="js/dark-mode-switch.js"></script>
    <script src="js/no-internet.js"></script>
    <script src="js/active.js"></script>
    <script src="js/pwa.js"></script>
	<script src="js/angular_data.js"></script>
  <script>
    $(document).ready(function(){
      $(document).on("click", "a.accept-case", function(){
        var id =$(this).attr("caseId");
        updateCase(id, response=>{
            alert(response.message);
        })
      })
      $(document).on("click", "a.deny-case", function(){
        var id =$(this).attr("caseId");
        updateCaseDeny(id, response=>{
            alert(response.message);
        })
      })
      $(document).on("click", "a.finish", function(){
        var id =$(this).attr("caseId");
        finish(id, response=>{
            alert(response.message);
        })
      })
     
     
     getProblems();

     function updateCase(id, get_response){
      $.ajax({
        method: "POST",
     url: "./doctor.api.php",
     data: {action: "updateCaseFromAdvocate", caseId : id},
     dataType: "JSON",
     success: (response)=>{
        get_response(response)
        getProblems();
     },
      error: (response)=>{
        console.log(response)

     }
      })
     }
     function updateCaseDeny(id, get_response){
      $.ajax({
        method: "POST",
     url: "./doctor.api.php",
     data: {action: "updateCaseFromAdvocatedeny", caseId : id},
     dataType: "JSON",
     success: (response)=>{
        get_response(response);
        getProblems();
     },
      error: (response)=>{
        console.log(response)

     }
      })
     }

     function finish(id, get_response){
      $.ajax({
        method: "POST",
     url: "./doctor.api.php",
     data: {action: "finish", caseId : id},
     dataType: "JSON",
     success: (response)=>{
        get_response(response)
        getProblems();
     },
      error: (response)=>{
        console.log(response)

     }
      })
     }

     function getProblems(){
       
       var data={
     "action": "ReadProblems",
   }
   $.ajax({
     method: "POST",
     url: "./doctor.api.php",
     data: data,
     dataType: "JSON",
     success:(response)=>{
      var html=""
      var tr="<tr>"
      const {data} = response;
      data.forEach(value=>{

        tr += `<td>${value.cus_id}</td>`;
              tr += `<td>${value.name}</td>`;
              tr += `<td>${value.field_4}</td>`;
              tr += `<td>${value.field_2}</td>`;
              tr += `<td>${value.field_5}</td>`;
              tr += `<td>${value.field_3}</td>`;
              if(value.status.toLowerCase()=="accepted")
                tr += `<td>
                  <a class='btn btn-secondary finish' caseId='${value.cus_id}' title='Accept This Case as Advocate'>processing...</a>
                  </td>`;
              else if(value.status.toLowerCase()=="finished")
              tr += `<td>
                  <a class='btn btn-secondary finish' caseId='${value.cus_id}' title='Accept This Case as Advocate'>Finished</a>
                  </td>`;
              else
                tr += `<td>
                  <a class='btn btn-success accept-case'  caseId='${value.cus_id}' title='Accept This Case as Advocate'>Accept</a>
                  <a class='btn btn-danger deny-case'  caseId='${value.cus_id}' title='Accept This Case as Advocate'>Deny</a>
                  </td>`;
              tr += `</tr>`;

  
      })
        
        // $(".problems").html(html)
        $(".problems tbody").html(tr)
       console.log("now response is",response);
     },
     error: (response)=>{
console.log("the response is ",response)
     }
   })
     }

   })


  </script>
  </body onload="onLoad()">	
</html>